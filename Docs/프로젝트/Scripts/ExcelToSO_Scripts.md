# ExcelToSO 스크립트 (Assets/ExcelToSO/Scripts)

> SASHA-Unity 프로젝트에서 Excel 데이터를 Unity ScriptableObject로 변환하는 데 사용되는 C# 에디터 스크립트(.cs 파일)들에 대한 문서입니다.

## 디렉토리 구조 및 주요 파일

- `/Assets/ExcelToSO/Scripts`
  - Excel 파일 파싱, ScriptableObject 생성 로직 등 Excel 데이터를 에디터에서 처리하는 핵심 스크립트들이 있습니다.
  - `ExcelParser.cs`: NPOI 라이브러리를 사용하여 Excel 파일(`.xlsx`)을 읽고 파싱하는 **정적(static) 유틸리티 클래스**입니다. 제네릭 메서드 `Parse<T>`를 통해 `IExcelRow` 인터페이스를 구현하는 데이터 모델 리스트로 Excel 데이터를 변환하는 핵심 로직을 제공합니다. 특정 `sheetName`을 지정하여 읽거나 첫 번째 시트를 기본으로 읽는 오버로딩된 `Parse` 메서드가 있습니다. 헤더 로우(0번 인덱스)를 건너뛰고 실제 데이터 로우부터 읽으며, 첫 번째 셀이 비어있는 로우는 데이터 끝으로 간주하여 건너뛰는 로직이 포함되어 있습니다.
  - `IExcelRow.cs`: Excel 파일의 **각 데이터 행을 나타내는 데이터 모델 클래스들이 구현해야 하는 인터페이스**입니다. `NPOI.SS.UserModel.IRow` 객체를 인자로 받아 해당 로우의 데이터를 읽어와 자신의 속성에 매핑하는 `void FromExcelRow(IRow row)` 메서드를 정의합니다. 이 인터페이스를 통해 `ExcelParser`는 어떤 데이터 타입이든 유연하게 파싱할 수 있습니다.
  - `ScriptableObjectGenerator.cs`: `ExcelParser`를 사용하여 파싱된 Excel 데이터를 기반으로 Unity **ScriptableObject(`.asset` 파일)를 생성하는 정적(static) 유틸리티 클래스**입니다. `Parse<TModel>`로 데이터를 읽어온 후, 각 데이터 항목(`TModel`)에 대해 새로운 ScriptableObject 인스턴스(`TSO`)를 생성합니다. Reflection을 사용하여 ScriptableObject의 `Apply(TModel data)` 메서드를 호출하며 데이터를 채워 넣습니다. 데이터 모델에 **`id` 프로퍼티가 필수**이며, 이 `id` 값을 사용하여 `.asset` 파일 이름을 생성하고 지정된 경로(`savePath`)에 저장합니다. `#if UNITY_EDITOR` 블록 안에 있어 **Unity 에디터 환경에서만 작동**합니다.

  - `/DataModels`
    - 파싱된 Excel 데이터가 임시로 저장되거나, ScriptableObject로 생성될 데이터 구조를 정의하는 스크립트들이 있습니다. 각 데이터 타입별 ScriptableObject 모델을 포함합니다.
    - `AbilityData.cs`: Excel의 어빌리티 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. `FromExcelRow` 메서드를 통해 Excel 행에서 `AbilityID`, `AbilityName`, `Description`, `AbilityType`, `TargetType`, `EffectType`, `EffectParameters`, `APCost`, `CooldownTurns`, `ActivationCondition`, `VisualEffectKey`, `SoundEffectKey`, `IconID`, `Notes` 등의 어빌리티 관련 데이터를 읽어와 자신의 프로퍼티에 매핑합니다. `id` 프로퍼티는 `AbilityID` 값을 반환하여 `ScriptableObjectGenerator`가 파일 이름으로 사용하도록 합니다. 데이터를 안전하게 읽기 위한 헬퍼 메서드(`GetStringValue`, `GetFloatValue`, `GetIntValue`)를 포함합니다.
    - `AssemblyData.cs`: Excel의 어셈블리 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. 특정 **조립체(Assembly) 구성 정보**를 정의하며, `FromExcelRow` 메서드를 통해 `AssemblyID`, `AFName`, `TeamID`, 그리고 해당 어셈블리를 구성하는 다른 데이터들의 ID를 참조하는 **외래 키(FK)** 필드들(`FrameID`, `PilotID`, `HeadPartID`, `BodyPartID`, `LeftArmPartID`, `RightArmPartID`, `LegsPartID`, `BackpackPartID`, `Weapon1ID`, `Weapon2ID`, `Notes`)을 읽어와 매핑합니다. `id` 프로퍼티는 `AssemblyID` 값을 반환하며, 숫자/문자열 파싱 헬퍼 메서드를 포함합니다.
    - `FlavorTextData.cs`: Excel의 플레이버 텍스트 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. **전투 로그 등에 사용될 설명적인 텍스트 템플릿** 정보를 정의하며, `FromExcelRow` 메서드를 통해 고유 `id`, 관련된 템플릿들을 그룹화하는 `templateKey`, 그리고 실제 **플레이스홀더를 포함할 수 있는 텍스트 내용(`templateText`)**을 읽어와 매핑합니다. `id`, `templateKey`, `templateText` 필드는 필수입니다.
    - `FrameData.cs`: Excel의 프레임 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. `FromExcelRow` 메서드를 통해 `FrameID`, `FrameName`, `FrameType`, 다양한 **스탯**(`Stat_AttackPower`, `Stat_Defense`, `Stat_Speed`, `Stat_Accuracy`, `Stat_Evasion`, `Stat_Durability`, `Stat_EnergyEff`, `Stat_MaxAP`, `Stat_APRecovery`, `Stat_MaxRepairUses`), `FrameWeight`, 그리고 해당 프레임이 장착할 수 있는 **각 파츠/무기 슬롯 정보**(`Slot_Head`, `Slot_Body`, `Slot_Arm_L`, `Slot_Arm_R`, `Slot_Legs`, `Slot_Backpack`, `Slot_Weapon_1`, `Slot_Weapon_2`, `Notes`)를 읽어와 매핑합니다. `id` 프로퍼티는 `FrameID` 값을 반환하며, 기본적인 파싱 헬퍼 메서드를 포함합니다. `FrameType`은 Enum 파싱이 필요하며, 파싱 로직 개선에 대한 TODO 주석이 있습니다.
    - `PartData.cs`: Excel의 파츠 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. `FromExcelRow` 메서드를 통해 `PartID`, `PartName`, `PartType`, 다양한 **스탯**(`Stat_AttackPower`, `Stat_Defense`, `Stat_Speed`, `Stat_Accuracy`, `Stat_Evasion`, `Stat_Durability`, `Stat_EnergyEff`, `Stat_MaxAP`, `Stat_APRecovery`, `Stat_MaxRepairUses`), `MaxDurability`, `PartWeight`, 해당 파츠가 가지는 **어빌리티 목록(`Abilities`)**, `Notes` 등의 파츠 데이터를 읽어와 매핑합니다. `id` 프로퍼티는 `PartID` 값을 반환하며, 숫자/문자열 파싱 헬퍼 메서드를 포함합니다. `PartType`은 Enum 파싱이 필요하다는 TODO 주석이 있습니다.
    - `PilotData.cs`: Excel의 파일럿 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. `FromExcelRow` 메서드를 통해 Excel 행에서 `PilotID`, `PilotName`, 다양한 **스탯**(`Stat_AttackPower`, `Stat_Defense`, `Stat_Speed`, `Stat_Accuracy`, `Stat_Evasion`, `Stat_Durability`, `Stat_EnergyEff`, `Stat_MaxAP`, `Stat_APRecovery`, `Stat_MaxRepairUses`) 외 `Specialization`, `InitialLevel`, `InitialSkills`, `Notes` 등의 파일럿 데이터를 읽어와 프로퍼티에 매핑합니다. `id` 프로퍼티는 `PilotID` 값을 반환하며, 숫자/문자열 파싱 헬퍼 메서드를 포함합니다. `Specialization`은 Enum 파싱이 필요하다는 TODO 주석이 있습니다.
    - `WeaponData.cs`: Excel의 무기 시트 데이터를 담는 데이터 모델 클래스이자 `IExcelRow` 구현체입니다. `FromExcelRow` 메서드를 통해 `WeaponID`, `WeaponName`, `WeaponType`, `DamageType`, `BaseDamage`, `Accuracy`, `Range` (MaxRange), `MinRange`, `AttackSpeed`, `OverheatPerShot`, `AmmoCapacity`, `BaseAPCost`, `ReloadAPCost`, `ReloadTurns`, `SpecialEffects`, `AttackFlavorKey`, `ReloadFlavorKey`, `Notes` 등의 무기 관련 데이터를 읽어와 매핑합니다. `id` 프로퍼티는 `WeaponID` 값을 반환하며, 숫자/문자열 파싱 헬퍼 메서드를 포함합니다. `WeaponType`과 `DamageType`은 Enum 파싱이 필요하다는 TODO 주석이 있습니다.

  - `/Editor`
    - Unity 에디터에서 ExcelToSO 툴의 메뉴 항목이나 커스텀 창을 제공하는 스크립트들이 있습니다. 툴의 UI 및 에디터 통합 기능을 구현합니다.
    - `DataGeneratorMenu.cs`: Unity 에디터의 메뉴 바에 **"Tools/Generate AF Data from Excel" 항목을 추가**하는 에디터 스크립트입니다. `@MenuItem` 속성을 사용하여 메뉴 항목을 정의하며, 해당 메뉴 클릭 시 **`GenerateData` 정적 메서드가 실행**됩니다. 이 메서드는 미리 정의된 Excel 파일 경로(`Assets/AF/Data/AF_Data.xlsx`)를 읽어와 각 데이터 타입별(`FrameData`, `PartData`, `WeaponData`, `PilotData`, `AssemblyData`, `FlavorTextData`, `AbilityData`)로 해당하는 Excel 시트의 데이터를 파싱하고, `ScriptableObjectGenerator.Generate` 메서드를 호출하여 **Unity ScriptableObject(`.asset`) 파일들을 `Assets/AF/Data/Resources/[DataType]` 경로에 생성**합니다. 생성 후에는 `AssetDatabase.Refresh()`를 호출하여 프로젝트 창에 변경사항을 반영합니다. `#if UNITY_EDITOR` 블록 안에 있어 **Unity 에디터에서만 사용 가능**합니다. 