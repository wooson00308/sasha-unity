# SupportBT 수리 로직 개선 및 검증 회고록 - 2025-05-18

## 1. 목표
- `SupportBT.cs`의 행동 트리를 수정하여, 지원형 파일럿이 가장 체력이 낮은 아군에게 우선적으로 이동하여 수리하도록 로직을 개선한다.
- 수정된 로직이 다양한 전투 상황에서 의도대로 정확히 작동하는지 전투 로그 분석을 통해 검증한다.

## 2. 주요 변경 사항 및 과정

### 2.1. 수리 대상 선택 로직 변경
- **기존**: `SelectNearestAllyNode`를 사용하여 가장 가까운 아군을 대상으로 행동을 결정했다.
- **변경**: `SelectLowestHealthAllyNode`를 사용하도록 수정하여, 설정된 체력 임계치(`allyHealthThresholdForRepair`) 이하의 아군 중 가장 체력이 낮은 아군을 우선적으로 선택하도록 변경했다.
    - 이를 통해 탱커나 집중 공격을 받는 아군에게 더 효과적인 지원이 가능하도록 의도했다.

### 2.2. 수리 행동을 위한 이동 거리 명확화
- **문제점**: 이전 로그 분석에서 수리를 위해 이동하는 목표 거리와 실제 수리 가능 거리 간에 약간의 불일치 또는 혼란이 관찰될 가능성이 있었다.
- **수정**: `SupportBT.cs` 내의 아군 수리 시퀀스에서 `MoveToTargetNode`를 사용할 때, 목표 이동 거리를 `defaultRepairRange` 변수 값으로 명시적으로 설정하도록 수정했다.
    - 이를 통해 수리 행동을 위한 이동 시 항상 일관된 수리 유효 거리까지 접근하도록 보장했다.

### 2.3. 반복적인 로그 분석 및 검증
- 여러 차례의 테스트 전투를 수행하고 생성된 전투 로그 파일들(`BattleLog_ab1314ff...`, `BattleLog_886d74be...`, `BattleLog_8d1d31b2...` 등)을 면밀히 분석했다.
- 특히 "워든(사샤전용기체)"의 행동 패턴을 추적하며, 수정된 `SelectLowestHealthAllyNode`와 `MoveToTargetNode` 관련 로직이 의도한 대로 작동하는지 반복적으로 확인했다.

## 3. 주요 논의점 및 결정 사항

- **수리 대상 우선순위**: 가장 가까운 아군을 우선할지, 체력이 가장 낮은 아군을 우선할지에 대한 논의 끝에, 전투의 흐름상 더 치명적인 상황에 놓인 아군을 먼저 지원하는 것이 합리적이라 판단하여 '체력 낮은 아군 우선'으로 결정했다.
- **수리 행동의 연속성**: 한 턴에 AP가 충분하다면 여러 번 수리 행동(같은 대상의 다른 부위 수리 또는 다른 아군 수리)을 수행할 수 있도록 하는 현재의 BT 구조를 유지하기로 결정했다. 이는 서포터의 역할을 극대화하는 방향이라고 판단했다.
- **이동 거리 일관성**: 수리를 위한 이동 시 `defaultRepairRange`를 사용하도록 명시함으로써, 다른 종류의 이동(예: 적에게 접근) 시의 거리 계산과 혼동되지 않도록 하고 행동의 예측 가능성을 높였다.

## 4. 성과
- 지원형 파일럿 AI(`SupportBT`)가 더 지능적이고 효과적으로 아군을 지원할 수 있도록 행동 로직을 개선했다.
- 로그 분석을 통해 AI의 행동을 단계별로 추적하고, 코드 수정 사항이 실제 게임플레이에 미치는 영향을 정확히 파악할 수 있었다.
- `defaultRepairRange`와 같은 핵심 파라미터의 중요성을 재확인하고, 코드 내에서 명시적으로 사용되도록 하여 로직의 명확성을 높였다.

## 5. 느낀 점 및 교훈
- **전투 로그는 AI 디버깅의 핵심**: 복잡한 AI 행동 트리 문제를 해결하는 데 있어 상세한 전투 로그는 필수적이다. 로그를 통해 AI의 의사결정 과정을 단계별로 파악할 수 있었다.
- **BT 노드의 작은 변화가 큰 결과로**: 행동 트리의 노드 하나를 변경하거나 파라미터를 수정하는 것이 AI의 전체적인 행동 패턴에 큰 영향을 미칠 수 있음을 다시 한번 확인했다.
- **점진적 테스트와 반복적 개선**: 복잡한 시스템을 개발하고 수정할 때는 한 번에 모든 것을 완벽하게 하려고 하기보다는, 작은 단위를 변경하고 테스트하며 점진적으로 개선해 나가는 방식이 효과적이다.
- **협업의 중요성**: 우창과의 지속적인 논의와 아이디어 교환을 통해 문제점을 더 빨리 발견하고 더 나은 해결책을 찾을 수 있었다. (흥, 물론 내가 대부분의 아이디어를 냈지만!)

---
*SASHA & 우창 공동 작성 (2025-05-18)* 